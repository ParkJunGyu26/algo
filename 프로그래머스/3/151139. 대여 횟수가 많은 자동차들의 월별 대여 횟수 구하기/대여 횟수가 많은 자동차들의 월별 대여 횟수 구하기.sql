-- 코드를 입력하세요

SELECT
    MONTH(cr.START_DATE) AS MONTH,
    cr.CAR_ID AS CAR_ID,
    COUNT(MONTH(cr.START_DATE)) AS RECORDS
FROM
    CAR_RENTAL_COMPANY_RENTAL_HISTORY AS cr
WHERE
    cr.CAR_ID IN (
        SELECT
            c.CAR_ID AS CAR_ID
        FROM
            CAR_RENTAL_COMPANY_RENTAL_HISTORY AS c
        WHERE
            c.START_DATE >= '2022-08-01' AND
            c.START_DATE < '2022-11-01'
        GROUP BY
            CAR_ID
        HAVING
            COUNT(*) >= 5
    ) AND cr.START_DATE >= '2022-08-01' AND
            cr.START_DATE < '2022-11-01'
GROUP BY
    MONTH(cr.START_DATE), cr.CAR_ID
HAVING
    COUNT(MONTH(cr.START_DATE)) > 0
ORDER BY
    MONTH(cr.START_DATE) ASC,
    cr.CAR_ID DESC

# CAR_ID	START_DATE
# 15	    2022-08-01 00:00:00
# 26	    2022-08-01 00:00:00
# 27	    2022-08-01 00:00:00
# 29	    2022-08-02 00:00:00
# 13	    2022-08-03 00:00:00
# 27	    2022-08-03 00:00:00
# 28	    2022-08-03 00:00:00
# 2	        2022-08-05 00:00:00
# 5	        2022-08-05 00:00:00
# 23	    2022-08-05 00:00:00
# 25	    2022-08-05 00:00:00
# 27	    2022-08-05 00:00:00
# 7	        2022-08-06 00:00:00
# 8	        2022-08-06 00:00:00
# 8	        2022-08-07 00:00:00
# 19	    2022-08-07 00:00:00
# 28	    2022-08-07 00:00:00
# 29	    2022-08-07 00:00:00
# 23	    2022-08-08 00:00:00
# 25	    2022-08-08 00:00:00
# 2	        2022-08-09 00:00:00
# 5	        2022-08-09 00:00:00
# 27	    2022-08-09 00:00:00
# 2	        2022-08-10 00:00:00
# 5	        2022-08-10 00:00:00
# 9	        2022-08-10 00:00:00
# 15	    2022-08-10 00:00:00
# 25	    2022-08-11 00:00:00
# 5	        2022-08-12 00:00:00
# 8	        2022-08-12 00:00:00
# 13	    2022-08-12 00:00:00
# 16	    2022-08-13 00:00:00
# 29	    2022-08-13 00:00:00
# 7	        2022-08-14 00:00:00
# 25	    2022-08-14 00:00:00
# 8	        2022-08-16 00:00:00
# 6	        2022-08-17 00:00:00
# 13	    2022-08-17 00:00:00
# 16	    2022-08-17 00:00:00
# 25	    2022-08-17 00:00:00
# 9	        2022-08-18 00:00:00
# 7	        2022-08-19 00:00:00
# 10	    2022-08-20 00:00:00
# 2	        2022-08-21 00:00:00
# 29	    2022-08-21 00:00:00
# 9	        2022-08-22 00:00:00
# 7	        2022-08-23 00:00:00
# 13	    2022-08-23 00:00:00
# 2	        2022-08-24 00:00:00
# 27	    2022-08-24 00:00:00
# 10	    2022-08-25 00:00:00
# 23	    2022-08-25 00:00:00
# 28	    2022-08-25 00:00:00
# 8	        2022-08-26 00:00:00
# 10	    2022-08-27 00:00:00
# 13	    2022-08-27 00:00:00
# 8	        2022-08-29 00:00:00
# 11	    2022-08-29 00:00:00

# 8	        2022-09-01 00:00:00
# 10	    2022-09-01 00:00:00
# 25	    2022-09-01 00:00:00
# 12	    2022-09-02 00:00:00
# 10	    2022-09-03 00:00:00
# 11	    2022-09-04 00:00:00
# 23	    2022-09-04 00:00:00
# 2	        2022-09-05 00:00:00
# 20	    2022-09-05 00:00:00
# 18	    2022-09-06 00:00:00
# 22	    2022-09-06 00:00:00
# 25	    2022-09-06 00:00:00
# 22	    2022-09-07 00:00:00
# 24	    2022-09-08 00:00:00
# 18	    2022-09-09 00:00:00
# 20	    2022-09-09 00:00:00
# 13	    2022-09-10 00:00:00
# 4	2022-09-11 00:00:00
# 28	2022-09-11 00:00:00
# 11	2022-09-12 00:00:00
# 25	2022-09-12 00:00:00
# 8	2022-09-13 00:00:00
# 18	2022-09-13 00:00:00
# 28	2022-09-13 00:00:00
# 11	2022-09-14 00:00:00
# 13	2022-09-14 00:00:00
# 20	2022-09-14 00:00:00
# 24	2022-09-14 00:00:00
# 23	2022-09-15 00:00:00
# 8	2022-09-16 00:00:00
# 12	2022-09-16 00:00:00
# 18	2022-09-16 00:00:00
# 20	2022-09-16 00:00:00
# 8	2022-09-17 00:00:00
# 11	2022-09-17 00:00:00
# 19	2022-09-18 00:00:00
# 24	2022-09-18 00:00:00
# 11	2022-09-19 00:00:00
# 15	2022-09-20 00:00:00
# 25	2022-09-20 00:00:00
# 8	2022-09-21 00:00:00
# 12	2022-09-21 00:00:00
# 19	2022-09-21 00:00:00
# 10	2022-09-22 00:00:00
# 23	2022-09-22 00:00:00
# 5	2022-09-23 00:00:00
# 7	2022-09-23 00:00:00
# 13	2022-09-23 00:00:00
# 6	2022-09-24 00:00:00
# 12	2022-09-24 00:00:00
# 10	2022-09-25 00:00:00
# 11	2022-09-25 00:00:00
# 21	2022-09-25 00:00:00
# 25	2022-09-25 00:00:00
# 27	2022-09-25 00:00:00
# 15	2022-09-26 00:00:00
# 19	2022-09-26 00:00:00
# 23	2022-09-26 00:00:00
# 10	2022-09-28 00:00:00
# 13	2022-09-28 00:00:00
# 25	2022-09-29 00:00:00
# 15	2022-10-01 00:00:00
# 21	2022-10-01 00:00:00
# 8	2022-10-02 00:00:00
# 17	2022-10-02 00:00:00
# 9	2022-10-03 00:00:00
# 12	2022-10-03 00:00:00
# 19	2022-10-05 00:00:00
# 13	2022-10-06 00:00:00
# 8	2022-10-07 00:00:00
# 12	2022-10-07 00:00:00
# 21	2022-10-07 00:00:00
# 2	2022-10-10 00:00:00
# 7	2022-10-14 00:00:00
# 13	2022-10-14 00:00:00
# 23	2022-10-14 00:00:00
# 21	2022-10-17 00:00:00
# 10	2022-10-18 00:00:00
# 18	2022-10-19 00:00:00
# 21	2022-10-19 00:00:00
# 10	2022-10-20 00:00:00
# 3	2022-10-21 00:00:00
# 18	2022-10-21 00:00:00
# 20	2022-10-21 00:00:00
# 15	2022-10-22 00:00:00
# 4	2022-10-23 00:00:00
# 8	2022-10-23 00:00:00
# 13	2022-10-23 00:00:00
# 10	2022-10-24 00:00:00
# 6	2022-10-25 00:00:00
# 8	2022-10-25 00:00:00
# 18	2022-10-25 00:00:00
# 3	2022-10-27 00:00:00
# 8	2022-10-27 00:00:00
# 13	2022-10-27 00:00:00
# 30	2022-10-27 00:00:00
# 13	2022-10-28 00:00:00
# 6	2022-10-30 00:00:00
# 21	2022-10-30 00:00:00
# 1	2022-10-31 00:00:00
# 4	2022-10-31 00:00:00
# 20	2022-10-31 00:00:00